<% provide(:title, "Location") %>

<head>
    <script src="https://maps.googleapis.com/maps/api/js?&callback=initialize"
      async defer>
    </script>
 <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 100%;
    }
  </style>
</head>

<body>
<div id ="map">
</div>

<script>

//<!--setting up initial map of Vancouver region-->
function initialize(){
  //global array to store coordinates travelled
  var coordsArray = [];
  
  var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 49, lng: 123},
    zoom: 18
  });
  
  var marker = new google.maps.Marker({map: map});
//  var info_window = new google.maps.InfoWindow({map: map});

  
//  function updatePosition(){
    
    repeatUpdatePos(coordsArray);
    
    function repeatUpdatePos(array){
    
      if( navigator.geolocation ){
        navigator.geolocation.getCurrentPosition(showPosition, errorMessage);
      }
      else{
        alert("Error: This browser does not support geolocation.");
      //  infoWindow.setContent("X This browser does not support geolocation.");
      }
      
      function showPosition(position){
  
    //a1
  
        pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
//        coordsArray.push("{lat: " + pos.lat + ", lng: " + pos.lng + "}" );
        coordsArray.push(pos);
        
    //a2 
        
        marker.setPosition(pos);
        map.setCenter(pos);
        
        var runningPath = new google.maps.Polyline({
          path: coordsArray,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
        
        runningPath.setMap(map);
      
        }
//        alert(coordsArray);
        setTimeout(repeatUpdatePos,10000);
    }
  
}

    function errorMessage(error){
      alert("Error: Location info is unavailable.");
    //  infoWindow.setContent("X Location info is unavailable.");
    };

</script>
</body>
